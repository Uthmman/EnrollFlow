
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    match /registrations/{registrationId} {
      // Allow authenticated users to create new registrations
      allow create: if request.auth != null;

      // Allow users whose email matches YOUR_ADMIN_EMAIL_HERE to read registrations
      // IMPORTANT: Replace "YOUR_ADMIN_EMAIL_HERE" with the actual email address
      // you've set in your NEXT_PUBLIC_ADMIN_EMAIL environment variable.
      allow read: if request.auth != null && request.auth.token.email == "YOUR_ADMIN_EMAIL_HERE";

      // For now, explicitly deny update and delete for registrations.
      // These can be refined later for admin-specific actions if needed.
      allow update, delete: if false;
    }

    match /programs/{programId} {
      // Allow anyone to read program data
      allow read: if true;
      // Allow writes for development/seeding.
      // This allows the client-side ensureInitialDataInFirestore to work.
      // TODO: For production, change to admin-only (e.g., if request.auth.token.email == "YOUR_ADMIN_EMAIL_HERE";)
      allow write: if true;
    }

    match /paymentMethods/{methodId} {
      // Allow anyone to read payment methods
      allow read: if true;
      // Allow writes for development/seeding.
      // This allows the client-side ensureInitialDataInFirestore to work.
      // TODO: For production, change to admin-only (e.g., if request.auth.token.email == "YOUR_ADMIN_EMAIL_HERE";)
      allow write: if true;
    }

    // Default deny all other paths if not explicitly matched above
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
